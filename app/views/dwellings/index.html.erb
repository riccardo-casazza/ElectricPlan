<p style="color: green"><%= notice %></p>

<% content_for :title, "Dwellings" %>

<div style="margin-bottom: 1rem;">
  <%= link_to "← Back to Home", root_path %>
</div>

<h1>Dwellings</h1>

<div style="margin: 1.5rem 0;">
  <%= link_to "New Dwelling", new_dwelling_path, class: "button-primary" %>
</div>

<table class="crud-table">
  <thead>
    <tr>
      <th>Name</th>
      <th>Electrical Panels</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <% @dwellings.each do |dwelling| %>
      <tr>
        <td><%= dwelling.name %></td>
        <td><%= dwelling.electrical_panels.count %></td>
        <td class="actions">
          <% has_any_errors = dwelling.has_compliance_errors? %>
          <% compliance_class = has_any_errors ? "button-small button-danger" : "button-small button-success" %>
          <% compliance_icon = has_any_errors ? "⚠" : "✓" %>
          <%= link_to compliance_icon, dwelling, class: compliance_class, title: has_any_errors ? "Has compliance issues" : "Compliant" %>
          <%= link_to "Edit", edit_dwelling_path(dwelling), class: "button-small button-secondary" %>
          <%= button_to "Delete", dwelling, method: :delete, class: "button-small button-danger", form: { data: { turbo_confirm: "Are you sure you want to delete this dwelling and all its electrical panels?" } } %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<% if @dwellings.empty? %>
  <p style="margin-top: 2rem; color: #666;">No dwellings yet. Click "New Dwelling" to add one.</p>
<% end %>
