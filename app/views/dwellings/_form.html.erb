<%= form_with(model: dwelling, class: "crud-form", data: { controller: "location-select" }) do |form| %>
  <% if dwelling.errors.any? %>
    <div class="error-messages">
      <h3><%= pluralize(dwelling.errors.count, "error") %> prohibited this dwelling from being saved:</h3>
      <ul>
        <% dwelling.errors.each do |error| %>
          <li><%= error.full_message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="form-field">
    <%= form.label :name, "Dwelling Name" %>
    <%= form.text_field :name, class: "form-input", placeholder: "e.g., Main House, Apartment 101" %>
  </div>

  <div class="form-field">
    <%= form.label :country_code, "Country" %>
    <%= form.select :country_code,
        Carmen::Country.all.map { |c| [c.name, c.code] }.sort_by(&:first),
        { include_blank: "Select a country", selected: dwelling.country_code },
        { class: "form-input", data: { location_select_target: "country", action: "change->location-select#countryChanged" } } %>
  </div>

  <div class="form-field">
    <%= form.label :region_code, "Region" %>
    <%= form.select :region_code,
        dwelling.country&.subregions&.map { |r| [r.name, r.code] }&.sort_by(&:first) || [],
        { include_blank: "Select a region", selected: dwelling.region_code },
        { class: "form-input", data: { location_select_target: "region", action: "change->location-select#regionChanged" } } %>
  </div>

  <div class="form-field">
    <%= form.label :department_code, "Department" %>
    <%= form.select :department_code,
        dwelling.region&.subregions&.map { |d| [d.name, d.code] }&.sort_by(&:first) || [],
        { include_blank: "Select a department", selected: dwelling.department_code },
        { class: "form-input", data: { location_select_target: "department" } } %>
  </div>

  <fieldset style="margin-top: 1.5rem; padding: 1rem; border: 1px solid #ddd; border-radius: 4px;">
    <legend style="font-weight: bold; padding: 0 0.5rem;">Electrical Safety Characteristics</legend>

    <div class="form-field" style="margin-bottom: 0.75rem;">
      <%= form.check_box :has_lightning_protection, class: "form-checkbox" %>
      <%= form.label :has_lightning_protection, "Has lightning rod or within 50m of protected building", style: "display: inline; margin-left: 0.5rem;" %>
    </div>

    <div class="form-field" style="margin-bottom: 0.75rem;">
      <%= form.check_box :has_overhead_power_line, class: "form-checkbox" %>
      <%= form.label :has_overhead_power_line, "Fully or partially overhead power supply", style: "display: inline; margin-left: 0.5rem;" %>
    </div>

    <div class="form-field" style="margin-bottom: 0.75rem;">
      <%= form.check_box :has_safety_critical_persons, class: "form-checkbox" %>
      <%= form.label :has_safety_critical_persons, "Safety of persons is a concern (e.g., medical equipment)", style: "display: inline; margin-left: 0.5rem;" %>
    </div>

    <div class="form-field" style="margin-bottom: 0;">
      <%= form.check_box :has_sensitive_equipment, class: "form-checkbox" %>
      <%= form.label :has_sensitive_equipment, "Contains sensitive equipment (computers, electronics)", style: "display: inline; margin-left: 0.5rem;" %>
    </div>
  </fieldset>

  <div class="form-actions">
    <%= form.submit class: "button-primary" %>
    <%= link_to "Cancel", dwellings_path, class: "button-secondary" %>
  </div>
<% end %>
