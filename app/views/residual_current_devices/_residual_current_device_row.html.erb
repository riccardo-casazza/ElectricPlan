<% editing ||= false %>
<% if editing %>
  <% form_id = dom_id(residual_current_device, :form) %>
  <% if residual_current_device.errors.any? %>
    <tr>
      <td colspan="7" style="background-color: #fee; padding: 1rem;">
        <strong><%= pluralize(residual_current_device.errors.count, "error") %> prohibited this RCD from being saved:</strong>
        <ul style="margin: 0.5rem 0 0 1.5rem;">
          <% residual_current_device.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </td>
    </tr>
  <% end %>
  <tr class="editing" id="<%= dom_id(residual_current_device) %>">
    <td><%= residual_current_device.name || "Auto-generated" %></td>
    <td>
      <select name="residual_current_device[electrical_panel_id]" form="<%= form_id %>" class="form-input" style="width: 100%; min-width: 150px;" data-controller="select">
        <option value="">Select a panel</option>
        <% ElectricalPanel.all.each do |panel| %>
          <option value="<%= panel.id %>" <%= 'selected' if residual_current_device.electrical_panel_id == panel.id %>><%= panel.name %></option>
        <% end %>
      </select>
    </td>
    <td><input type="number" name="residual_current_device[row_number]" value="<%= residual_current_device.row_number %>" form="<%= form_id %>" class="form-input" style="width: 100%; min-width: 80px;"></td>
    <td><input type="number" name="residual_current_device[position]" value="<%= residual_current_device.position %>" form="<%= form_id %>" class="form-input" style="width: 100%; min-width: 80px;"></td>
    <td><input type="number" name="residual_current_device[output_max_current]" value="<%= residual_current_device.output_max_current %>" form="<%= form_id %>" class="form-input" style="width: 100%; min-width: 80px;"></td>
    <td>
      <select name="residual_current_device[residual_current_device_type_id]" form="<%= form_id %>" class="form-input" style="width: 100%; min-width: 150px;" data-controller="select">
        <option value="">Select a type</option>
        <% ResidualCurrentDeviceType.all.each do |type| %>
          <option value="<%= type.id %>" <%= 'selected' if residual_current_device.residual_current_device_type_id == type.id %>><%= type.name %></option>
        <% end %>
      </select>
    </td>
    <td class="actions">
      <input type="submit" value="Save" form="<%= form_id %>" class="button-small button-primary">
      <%= link_to "Cancel", residual_current_devices_path, class: "button-small button-secondary" %>
    </td>
  </tr>
<% else %>
  <tr id="<%= dom_id(residual_current_device) %>">
    <td><%= residual_current_device.name %></td>
    <td><%= residual_current_device.electrical_panel.name %></td>
    <td><%= residual_current_device.row_number %></td>
    <td><%= residual_current_device.position %></td>
    <td><%= residual_current_device.output_max_current %></td>
    <td><%= residual_current_device.residual_current_device_type.name %></td>
    <td class="actions">
      <%= link_to "Edit", edit_residual_current_device_path(residual_current_device), class: "button-small button-secondary" %>
      <%= button_to "Delete", residual_current_device, method: :delete, class: "button-small button-danger",
          form: { data: { turbo_confirm: "Are you sure you want to delete this RCD?" } } %>
    </td>
  </tr>
<% end %>
