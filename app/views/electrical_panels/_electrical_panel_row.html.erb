<% editing ||= false %>
<% if editing %>
  <% form_id = dom_id(electrical_panel, :form) %>
  <% if electrical_panel.errors.any? %>
    <tr>
      <td colspan="5" style="background-color: #fee; padding: 1rem;">
        <strong><%= pluralize(electrical_panel.errors.count, "error") %> prohibited this electrical panel from being saved:</strong>
        <ul style="margin: 0.5rem 0 0 1.5rem;">
          <% electrical_panel.errors.each do |error| %>
            <li><%= error.full_message %></li>
          <% end %>
        </ul>
      </td>
    </tr>
  <% end %>
  <tr class="editing" id="<%= dom_id(electrical_panel) %>">
    <td style="color: #666; font-style: italic;">
      <% if electrical_panel.persisted? %>
        <%= electrical_panel.name %>
      <% else %>
        (auto-generated)
      <% end %>
    </td>
    <td>
      <select name="electrical_panel[room_id]" form="<%= form_id %>" class="form-input" style="width: 100%; min-width: 200px;" data-controller="select" data-action="change->electrical-panel#updateFloor" data-electrical-panel-target="roomSelect">
        <option value="">Select a room</option>
        <% Room.includes(:floor).order('floors.name, rooms.name').each do |room| %>
          <option value="<%= room.id %>" data-floor="<%= room.floor.name %>" <%= 'selected' if electrical_panel.room_id == room.id %>>
            <%= "#{room.floor.name} - #{room.name}" %>
          </option>
        <% end %>
      </select>
    </td>
    <td style="color: #666;" data-electrical-panel-target="floorDisplay">
      <%= electrical_panel.persisted? && electrical_panel.room ? electrical_panel.room.floor.name : "N/A" %>
    </td>
    <td>
      <select name="electrical_panel[input_cable_id]" form="<%= form_id %>" class="form-input" style="width: 100%; min-width: 150px;" data-controller="select">
        <option value="">Select a cable</option>
        <% Cable.all.each do |cable| %>
          <option value="<%= cable.id %>" <%= 'selected' if electrical_panel.input_cable_id == cable.id %>><%= cable.section %></option>
        <% end %>
      </select>
    </td>
    <td class="actions">
      <input type="submit" value="Save" form="<%= form_id %>" class="button-small button-primary">
      <%= link_to "Cancel", electrical_panels_path, class: "button-small button-secondary" %>
    </td>
  </tr>
<% else %>
  <tr id="<%= dom_id(electrical_panel) %>">
    <td><%= electrical_panel.name %></td>
    <td><%= "#{electrical_panel.room.floor.name} - #{electrical_panel.room.name}" %></td>
    <td><%= electrical_panel.room.floor.name %></td>
    <td><%= electrical_panel.input_cable&.section || "N/A" %></td>
    <td class="actions">
      <%= link_to "Edit", edit_electrical_panel_path(electrical_panel), class: "button-small button-secondary" %>
      <%= button_to "Delete", electrical_panel, method: :delete, class: "button-small button-danger",
          form: { data: { turbo_confirm: "Are you sure you want to delete this electrical panel?" } } %>
    </td>
  </tr>
<% end %>
